<head>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://api.trello.com/1/client.js?key=83fbbffdca68e9e5655f409d9b204618"></script>
<!--  python -m http.server -->
</head>
<body>
<script>

lists=undefined;
counter = 0;

requiredLists = ["Done", "Today", "Inbox"]
requiredWorkList = ["Today", "Inbox"]

var done = function(){
	counter = counter + 1;
	if(counter >= Object.keys(lists).length ){
		console.log("check we have Done and Today");
		console.log("check Today has associated time, transform to pomodoro ticks");
		console.log("check and add tags for time");
		console.log("check today is sane @time");
		console.log("check today for date. want everything that is in today to be moved to today, or to be moved to inbox?");
		console.log("estimate success of today ending. Stop if under 30%");
		console.log("Check today. Check number of items with a warning if they exceed 6. Error out if they exceed 10. Check dates of items. Error out and offer fix with place or fix with move if they're not for today. Compute time left and estimate success. Error out If under 30%");
	}
}

var populateList = function(listID){
	var success = function(answer) {
		cards = {};
		for(i in answer){
			card = answer[i];
			cards[card.id] = card;
		}
		lists[listID].cards = cards;
		done();
	};

	var error = function(errorMsg) {
	  console.log(errorMsg);
	};

	Trello.get('/lists/'+ listID +'/cards', success, error);
}

var boardSelect = function(boardID){
	var success = function(answer) {
		document.getElementById("p1").innerHTML = "";
		lists = {};
		for(i in answer){
			list = answer[i];
			lists[list.id] = list;
		}
		for(i in lists){
			populateList(i);
		}
	};

	var error = function(errorMsg) {
	  console.log(errorMsg);
	};

	Trello.get('/boards/'+ boardID +'/lists', success, error);
}

var authenticationSuccess = function() { 
	console.log("Successful authentication");
	var success = function(boards) {
		document.getElementById("p1").innerHTML = "";
		for( i in boards){
			item = boards[i];
			document.getElementById("p1").innerHTML = document.getElementById("p1").innerHTML +
			"<button onclick=\"boardSelect('"+item.id+"')\">" + 
			item.name + "</button><br/>";
		}
	};

	var error = function(errorMsg) {
		console.log(errorMsg);
	};

	Trello.get('/member/me/boards', success, error)
};
var authenticationFailure = function() { alert("Failed authentication"); };

Trello.authorize({
  type: 'popup',
  name: 'Getting Started Application',
  scope: {
    read: 'true',
    write: 'true' },
  expiration: 'never',
  success: authenticationSuccess,
  error: authenticationFailure
});
</script>
<p id="p1">Hello World!</p>
</body>

